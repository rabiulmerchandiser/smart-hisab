<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary-pink: #e91e63;
            --header-cyan: #80ced6;
            --income-green: #0e8a16;
            --expense-red: #c90a4d;
            --balance-teal: #3949ab;
            --bg-light: #f3f4f6;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: var(--bg-light);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .app-container {
            width: 100vw;
            max-width: 450px;
            background-color: var(--bg-light);
            min-height: 100vh;
            height: 100vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            position: relative;
            overflow-x: hidden;
            overflow-y: hidden;
        }

        /* ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ */
        .page-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }

        /* PIN Screen */
        /* Auth Screen */
        #auth-screen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            z-index: 3000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            padding: 20px;
        }

        .auth-logo {
            font-size: 48px;
            margin-bottom: 8px;
        }

        .auth-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 6px;
        }

        .auth-subtitle {
            font-size: 13px;
            opacity: 0.8;
            margin-bottom: 30px;
        }

        .auth-box {
            background: white;
            border-radius: 20px;
            padding: 25px 20px;
            width: 100%;
            max-width: 340px;
            color: #333;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            background: #f1f3f5;
            border-radius: 10px;
            padding: 4px;
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            transition: 0.2s;
            color: #666;
        }

        .auth-tab.active {
            background: var(--balance-teal);
            color: white;
        }

        .auth-form { display: none; }
        .auth-form.active { display: block; }

        .auth-input-group {
            margin-bottom: 14px;
        }

        .auth-input-group label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #555;
            margin-bottom: 5px;
        }

        .auth-input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            font-family: inherit;
            outline: none;
            transition: 0.2s;
            box-sizing: border-box;
        }

        .auth-input-group input:focus {
            border-color: var(--balance-teal);
        }

        .auth-btn {
            width: 100%;
            padding: 14px;
            background: var(--balance-teal);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            margin-top: 5px;
        }

        .auth-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,128,128,0.4); }

        .auth-error {
            color: #e53935;
            font-size: 12px;
            text-align: center;
            margin-top: 8px;
            min-height: 18px;
            font-weight: 600;
        }

        .auth-success {
            color: #2e7d32;
            font-size: 12px;
            text-align: center;
            margin-top: 8px;
            min-height: 18px;
            font-weight: 600;
        }

        .forgot-link {
            display: block;
            text-align: center;
            margin-top: 10px;
            font-size: 12px;
            color: var(--balance-teal);
            cursor: pointer;
            text-decoration: underline;
            font-weight: 600;
        }

        .forgot-link:hover { opacity: 0.75; }

        .security-question-display {
            background: #f0f7ff;
            border: 2px solid #90caf9;
            border-radius: 10px;
            padding: 12px 14px;
            font-size: 14px;
            font-weight: 600;
            color: #1565c0;
            margin-bottom: 12px;
            text-align: center;
        }

        /* User indicator in header */
        .user-indicator {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            background: rgba(0,0,0,0.15);
            padding: 4px 10px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            white-space: nowrap;
            max-width: 100px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-indicator:hover { background: rgba(0,0,0,0.25); }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1a237e 0%, #283593 50%, #3949ab 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 20px;
            position: relative;
            box-shadow: 0 2px 8px rgba(26,35,126,0.4);
        }

        .menu-icon {
            position: absolute;
            right: 15px;
            top: 12px;
            font-size: 28px;
            cursor: pointer;
            color: #fff;
            transition: 0.2s;
        }

        .menu-icon:hover {
            transform: scale(1.1);
        }

        /* Side Menu */
        .side-menu {
            position: fixed;
            top: 0;
            right: -280px;
            width: 250px;
            height: 100%;
            background: white;
            z-index: 2000;
            transition: 0.4s;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            box-shadow: -5px 0 15px rgba(0,0,0,0.2);
            overflow-y: auto;
        }

        .side-menu.active { right: 0; }

        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1500;
            display: none;
        }

        .menu-overlay.active {
            display: block;
        }

        .menu-item {
            background: #f1f3f5;
            padding: 14px;
            border-radius: 12px;
            font-size: 14px;
            text-align: center;
            cursor: pointer;
            border: 1px solid #dee2e6;
            font-weight: 600;
            color: #333;
            display: block;
            text-decoration: none;
            transition: 0.2s;
        }

        .menu-item:hover {
            background: #e9ecef;
            transform: translateX(-5px);
        }

        /* Entry Panel (NEW) */
        .entry-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2500;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .entry-panel.active { display: flex; }
        .entry-panel-content {
            background: white;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            border-radius: 20px;
            padding: 20px;
            overflow-y: auto;
            position: relative;
        }
        .close-panel {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 28px;
            cursor: pointer;
            color: #666;
            transition: 0.2s;
        }

        .close-panel:hover {
            color: #000;
            transform: scale(1.2);
        }

        .entry-tabs {
            display: flex;
            margin: 20px 0 20px;
            gap: 5px;
        }
        .entry-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: #eee;
            cursor: pointer;
            font-weight: bold;
            border-radius: 8px;
            transition: 0.2s;
            font-size: 16px;
        }
        .entry-tab.active {
            background: var(--primary-pink);
            color: white;
        }

        .entry-form {
            display: none;
        }
        .entry-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary-pink);
        }

        .submit-btn {
            width: 100%;
            padding: 14px;
            background: var(--primary-pink);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            margin-top: 10px;
        }
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(233, 30, 99, 0.4);
        }

        /* Category Management Panel */
        .category-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2500;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .category-panel.active { display: flex; }
        .category-panel-content {
            background: white;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            border-radius: 20px;
            padding: 20px;
            overflow-y: auto;
            position: relative;
        }

        .cat-tabs {
            display: flex;
            margin: 20px 0 10px;
            gap: 5px;
        }
        .cat-tab {
            flex: 1;
            padding: 10px;
            border: none;
            background: #eee;
            cursor: pointer;
            font-weight: bold;
            border-radius: 8px;
            transition: 0.2s;
        }
        .cat-tab.active {
            background: var(--primary-pink);
            color: white;
        }
        .cat-list {
            margin: 15px 0;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 5px;
        }
        .cat-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }

        .cat-item:last-child {
            border-bottom: none;
        }

        .cat-item-info {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }
        .cat-color-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .cat-actions button {
            padding: 5px 10px;
            margin-left: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: 0.2s;
        }
        .cat-edit-btn {
            background: #4CAF50;
            color: white;
        }
        .cat-delete-btn {
            background: #f44336;
            color: white;
        }
        .cat-actions button:hover {
            transform: scale(1.05);
        }

        .cat-add-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #eee;
        }
        .cat-add-inputs {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .cat-add-inputs input {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }
        .cat-add-inputs input[type="color"] {
            width: 50px;
            padding: 5px;
            cursor: pointer;
        }
        .cat-add-btn {
            width: 100%;
            padding: 10px;
            background: var(--primary-pink);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }
        .cat-add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(233,30,99,0.3);
        }

        /* FIXED TOP SECTION */
        .fixed-top-section {
            position: sticky;
            top: 0;
            z-index: 50;
            background-color: var(--bg-light);
        }

        /* Summary Cards */
        .summary {
            padding: 10px 12px 6px;
        }

        .balance-card {
            background: linear-gradient(135deg, #1565c0 0%, #0d47a1 50%, #1a237e 100%);
            color: white;
            padding: 12px 16px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 3px 12px rgba(21,101,192,0.4);
            margin-bottom: 8px;
        }

        .balance-card-title {
            font-size: 12px;
            font-weight: 600;
            opacity: 0.85;
            margin-bottom: 4px;
            letter-spacing: 0.3px;
        }

        .balance-card-amount {
            font-size: 28px;
            font-weight: bold;
            letter-spacing: 0.5px;
        }

        .income-expense-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .card {
            background-color: white;
            padding: 8px 10px;
            border-radius: 14px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .card:nth-child(1) { 
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-bottom: 3px solid var(--income-green);
        }

        .card:nth-child(2) { 
            background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%);
            border-bottom: 3px solid var(--expense-red);
        }

        .card:nth-child(3) {
            background: linear-gradient(135deg, #e8eaf6 0%, #c5cae9 100%);
            border-bottom: 3px solid #3949ab;
        }

        .card-title {
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 3px;
            opacity: 0.8;
        }

        .card-amount {
            font-size: 15px;
            font-weight: bold;
        }

        .income {
            background: linear-gradient(135deg, #1b5e20, #43a047);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .expense {
            background: linear-gradient(135deg, #880e4f, #e91e63);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .balance {
            background: linear-gradient(135deg, #1a237e, #3949ab, #7986cb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* View Selection Container */
        .view-selection {
            background: white;
            margin: 0 12px 8px;
            padding: 8px 10px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .view-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            margin-bottom: 8px;
        }

        .view-btn {
            padding: 8px 4px;
            background-color: #eee;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 12px;
            transition: 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .view-btn.active {
            background-color: var(--primary-pink);
            color: white;
        }

        .view-btn:hover {
            transform: translateY(-2px);
        }

        .filter-controls {
            padding: 10px 0;
        }

        .filter-row {
            display: flex;
            gap: 10px;
            margin-bottom: 8px;
        }

        .filter-controls select,
        .filter-controls input[type="date"] {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
        }

        /* Chart Section */
        .chart-section {
            background: white;
            margin: 10px 15px;
            padding: 15px;
            border-radius: 20px;
            border-bottom: 4px solid var(--header-cyan);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .chart-header {
            text-align: center;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 15px;
            color: #333;
        }

        .chart-content {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .chart-container {
            position: relative;
            width: 160px;
            height: 160px;
            flex-shrink: 0;
        }

        .category-list {
            flex: 1;
            max-height: 160px;
            overflow-y: auto;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid #eee;
        }

        .category-item:last-child {
            border-bottom: none;
        }

        .category-name {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
        }

        .color-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .category-amount {
            font-weight: bold;
            color: #333;
            font-size: 13px;
        }

        /* Transaction List */
        .list-section {
            flex: 1;
            overflow-y: auto;
            padding: 0 15px 20px;
        }

        .item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 5px solid;
            flex-wrap: wrap;
        }

        .cat-badge {
            display: inline-block;
            background: #f0f0f0;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            margin-left: 8px;
            color: #666;
        }

        /* 3-dot dropdown menu */
        .item-actions {
            position: relative;
            display: inline-block;
            margin-left: 8px;
        }

        .three-dot-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #aaa;
            padding: 0 4px;
            border-radius: 6px;
            line-height: 1;
            transition: 0.15s;
            vertical-align: middle;
        }

        .three-dot-btn:hover {
            background: #f0f0f0;
            color: #555;
        }

        .dropdown-menu {
            position: absolute;
            right: 0;
            top: 110%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 6px 24px rgba(0,0,0,0.15);
            min-width: 130px;
            z-index: 500;
            overflow: hidden;
            display: none;
            animation: dropIn 0.15s ease;
        }

        @keyframes dropIn {
            from { opacity: 0; transform: translateY(-6px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        .dropdown-menu.open { display: block; }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 11px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            transition: 0.15s;
        }

        .dropdown-item:hover { background: #f5f5f5; }

        .dropdown-item.edit { color: #1976D2; }
        .dropdown-item.delete { color: #e53935; }

        .dropdown-divider {
            height: 1px;
            background: #f0f0f0;
            margin: 0;
        }

        /* Edit Modal */
        .edit-modal {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.55);
            z-index: 2800;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .edit-modal.active { display: flex; }

        .edit-modal-content {
            background: white;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            border-radius: 20px;
            padding: 24px 20px 20px;
            overflow-y: auto;
            position: relative;
        }

        .edit-modal-title {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .edit-type-badge {
            display: inline-block;
            padding: 3px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
            margin-left: 8px;
        }

        .empty-state {
            text-align: center;
            color: #999;
            padding: 40px 20px;
            font-size: 16px;
        }

        .date-filter-error {
            text-align: center;
            color: var(--expense-red);
            padding: 20px;
            font-weight: bold;
        }

        /* ‚îÄ‚îÄ Dark Mode ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        body.dark { background-color: #121212; }
        body.dark .app-container { background-color: #1e1e1e; }
        body.dark .header { background: linear-gradient(135deg, #0d1257 0%, #1a237e 100%); color: #e0e0e0; }
        body.dark .balance-card { background: linear-gradient(135deg, #0d1257, #1a237e); }
        body.dark .card { background-color: #2c2c2c; color: #e0e0e0; }
        body.dark .item { background-color: #2c2c2c; color: #e0e0e0; }
        body.dark .view-selection { background-color: #2c2c2c; }
        body.dark .view-btn { background-color: #3a3a3a; color: #ccc; }
        body.dark .chart-section { background-color: #2c2c2c; color: #e0e0e0; }
        body.dark .chart-header { color: #e0e0e0; }
        body.dark .side-menu { background-color: #2c2c2c; }
        body.dark .menu-item { background-color: #3a3a3a; color: #e0e0e0; border-color: #444; }
        body.dark .fixed-top-section { background-color: #1e1e1e; }
        body.dark .filter-controls select,
        body.dark .filter-controls input[type="date"] { background: #3a3a3a; color: #e0e0e0; border-color: #555; }
        body.dark .cat-badge { background: #3a3a3a; color: #bbb; }
        body.dark small { color: #aaa !important; }
        body.dark .three-dot-btn { color: #888; }
        body.dark .dropdown-menu { background: #2c2c2c; box-shadow: 0 6px 24px rgba(0,0,0,0.5); }
        body.dark .dropdown-item:hover { background: #3a3a3a; }
        body.dark .empty-state { color: #666; }
        body.dark .category-amount { color: #ccc; }

        /* ‚îÄ‚îÄ Search Bar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .search-bar {
            display: flex;
            align-items: center;
            background: white;
            margin: 0 12px 8px;
            padding: 8px 12px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            gap: 8px;
        }
        body.dark .search-bar { background: #2c2c2c; }
        .search-bar input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 14px;
            background: transparent;
            color: inherit;
        }
        .search-bar span { color: #aaa; font-size: 16px; }

        /* ‚îÄ‚îÄ Budget Section ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .budget-section {
            background: white;
            margin: 0 12px 8px;
            padding: 12px;
            border-radius: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: none;
        }
        body.dark .budget-section { background: #2c2c2c; }
        .budget-section.visible { display: block; }
        .budget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-weight: bold;
            font-size: 14px;
        }
        .budget-item {
            margin-bottom: 10px;
        }
        .budget-label {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 4px;
            color: #555;
        }
        body.dark .budget-label { color: #aaa; }
        .budget-bar-bg {
            height: 8px;
            background: #eee;
            border-radius: 4px;
            overflow: hidden;
        }
        body.dark .budget-bar-bg { background: #3a3a3a; }
        .budget-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.4s ease;
        }
        .budget-warn { color: #ff5722 !important; font-weight: bold; }

        /* ‚îÄ‚îÄ Bar Chart Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .chart-modal {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.55);
            z-index: 2800;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .chart-modal.active { display: flex; }
        .chart-modal-content {
            background: white;
            width: 95%;
            max-width: 440px;
            max-height: 90vh;
            border-radius: 20px;
            padding: 20px;
            overflow-y: auto;
            position: relative;
        }
        body.dark .chart-modal-content { background: #2c2c2c; color: #e0e0e0; }
        .chart-modal-title {
            text-align: center;
            font-size: 17px;
            font-weight: bold;
            margin-bottom: 16px;
        }

        /* ‚îÄ‚îÄ Budget Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .budget-modal {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.55);
            z-index: 2800;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .budget-modal.active { display: flex; }
        .budget-modal-content {
            background: white;
            width: 92%;
            max-width: 400px;
            max-height: 90vh;
            border-radius: 20px;
            padding: 22px 18px;
            overflow-y: auto;
            position: relative;
        }
        body.dark .budget-modal-content { background: #2c2c2c; color: #e0e0e0; }

        /* ‚îÄ‚îÄ Note field ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: none;
            height: 64px;
        }
        body.dark .form-group textarea { background: #3a3a3a; color: #e0e0e0; border-color: #555; }
        .form-group textarea:focus { outline: none; border-color: var(--primary-pink); }
        body.dark .form-group input, body.dark .form-group select { background: #3a3a3a; color: #e0e0e0; border-color: #555; }


        /* ‚îÄ‚îÄ Note in transaction item ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .item-note {
            font-size: 11px;
            color: #888;
            margin-top: 2px;
            font-style: italic;
        }
        body.dark .item-note { color: #777; }

        /* ‚îÄ‚îÄ Share button ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .share-toast {
            position: fixed;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 13px;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s;
            white-space: nowrap;
        }
        .share-toast.show { opacity: 1; }

        /* ‚îÄ‚îÄ Settings Page ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .settings-list {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        body.dark .settings-list { background: #2c2c2c; }
        .settings-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: 0.15s;
        }
        body.dark .settings-item { border-bottom-color: #3a3a3a; color: #e0e0e0; }
        .settings-item:last-child { border-bottom: none; }
        .settings-item:hover { background: #f8f8f8; }
        body.dark .settings-item:hover { background: #3a3a3a; }
        .settings-item span:first-child { font-size: 18px; width: 28px; }
        .settings-item span:nth-child(2) { flex: 1; }
        .settings-item span:last-child { color: #bbb; font-size: 18px; }

        .app-container { padding-bottom: 0; }

        /* ‚îÄ‚îÄ Bottom Navigation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .bottom-nav {
            width: 100%;
            height: 68px;
            background: linear-gradient(180deg, #1e2e8e 0%, #1a237e 100%);
            display: flex;
            align-items: center;
            justify-content: space-around;
            flex-shrink: 0;
            box-shadow: 0 -1px 0 rgba(255,255,255,0.08), 0 -6px 24px rgba(0,0,0,0.35);
            position: sticky;
            bottom: 0;
            z-index: 100;
            padding: 0 6px;
            padding-bottom: env(safe-area-inset-bottom, 0px);
            overflow: visible;
            border-radius: 20px 20px 0 0;
        }
        body.dark .bottom-nav { background: linear-gradient(180deg, #0d1460 0%, #0d1257 100%); }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            cursor: pointer;
            flex: 1;
            height: 100%;
            padding: 8px 4px 6px;
            border: none;
            background: none;
            color: rgba(255,255,255,0.4);
            transition: color 0.2s, transform 0.15s;
            position: relative;
        }
        .nav-item:active { transform: scale(0.92); }

        /* Active pill indicator under icon */
        .nav-item.active {
            color: #ffffff;
        }
        .nav-item.active .nav-icon-wrap {
            background: rgba(255,255,255,0.18);
            border: 1.5px solid rgba(255,255,255,0.35);
            box-shadow: 0 0 10px rgba(144,202,249,0.3);
        }
        .nav-item .nav-icon-wrap {
            width: 40px;
            height: 28px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1.5px solid transparent;
            transition: background 0.2s, border-color 0.2s, box-shadow 0.2s;
        }
        .nav-item:hover:not(.active) .nav-icon-wrap {
            background: rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.15);
        }
        .nav-item svg { width: 20px; height: 20px; fill: currentColor; }
        .nav-item span { font-size: 10px; font-weight: 600; letter-spacing: 0.2px; }

        .nav-add-btn {
            width: 58px;
            height: 58px;
            background: linear-gradient(135deg, #880e4f, #e91e63);
            border: 3px solid rgba(255,255,255,0.45);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 -4px 16px rgba(136,14,79,0.45), 0 4px 16px rgba(233,30,99,0.4), 0 1px 0 rgba(255,255,255,0.25) inset;
            flex-shrink: 0;
            transition: transform 0.2s, box-shadow 0.2s;
            position: absolute;
            top: -29px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 101;
        }
        .nav-add-btn:active { transform: translateX(-50%) scale(0.91); box-shadow: 0 2px 8px rgba(233,30,99,0.4); }
        .nav-add-btn svg { width: 28px; height: 28px; fill: white; }

        /* Responsive */
        @media (max-width: 400px) {
            .view-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            .view-btn { font-size: 11px; padding: 7px 2px; }
            .nav-item { padding: 8px 8px; }
        }
    </style>
</head>
<body>

<!-- Auth Screen -->
<div id="auth-screen">
    <div class="auth-logo">üí∞</div>
    <div class="auth-title">‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</div>
    <div class="auth-subtitle">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶Ø‡¶º ‡¶ì ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ‡¶∏‡¶π‡¶ú‡ßá ‡¶™‡¶∞‡¶ø‡¶ö‡¶æ‡¶≤‡¶®‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</div>

    <div class="auth-box">
        <div class="auth-tabs">
            <button class="auth-tab active" onclick="switchAuthTab('login')">‡¶≤‡¶ó‡¶á‡¶®</button>
            <button class="auth-tab" onclick="switchAuthTab('register')">‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶®</button>
        </div>

        <!-- Login Form -->
        <div class="auth-form active" id="login-form">
            <div class="auth-input-group">
                <label>‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ</label>
                <input type="text" id="login-username" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ" onkeydown="if(event.key==='Enter') document.getElementById('login-pin').focus()">
            </div>
            <div class="auth-input-group">
                <label>PIN (‡ß™ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ)</label>
                <input type="password" id="login-pin" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeydown="if(event.key==='Enter') doLogin()">
            </div>
            <button class="auth-btn" onclick="doLogin()">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <div class="auth-error" id="login-error"></div>
            <span class="forgot-link" onclick="showForgotForm()">üîë PIN ‡¶≠‡ßÅ‡¶≤‡ßá ‡¶ó‡ßá‡¶õ‡ßá‡¶®?</span>
        </div>

        <!-- Register Form -->
        <div class="auth-form" id="register-form">
            <div class="auth-input-group">
                <label>‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ</label>
                <input type="text" id="reg-username" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ" onkeydown="if(event.key==='Enter') document.getElementById('reg-pin').focus()">
            </div>
            <div class="auth-input-group">
                <label>PIN (‡ß™ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ)</label>
                <input type="password" id="reg-pin" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeydown="if(event.key==='Enter') document.getElementById('reg-pin2').focus()">
            </div>
            <div class="auth-input-group">
                <label>PIN ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                <input type="password" id="reg-pin2" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeydown="if(event.key==='Enter') document.getElementById('reg-sq').focus()">
            </div>
            <div class="auth-input-group">
                <label>‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®</label>
                <select id="reg-sq">
                    <option value="">‚Äî ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡¶ø‡¶® ‚Äî</option>
                    <option value="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡ßÄ?">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡ßÄ?</option>
                    <option value="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶æ‡¶•‡¶Æ‡¶ø‡¶ï ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡¶Ø‡¶º‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡ßÄ?">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶æ‡¶•‡¶Æ‡¶ø‡¶ï ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡¶Ø‡¶º‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡ßÄ?</option>
                    <option value="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶ï‡ßÄ?">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶ï‡ßÄ?</option>
                    <option value="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Æ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡ßÄ?">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Æ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡ßÄ?</option>
                    <option value="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶™‡ßã‡¶∑‡¶æ ‡¶™‡ßç‡¶∞‡¶æ‡¶£‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡ßÄ?">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶™‡ßã‡¶∑‡¶æ ‡¶™‡ßç‡¶∞‡¶æ‡¶£‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡ßÄ?</option>
                    <option value="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡ßÄ?">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡ßÄ?</option>
                    <option value="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶∞‡¶ô ‡¶ï‡ßÄ?">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶∞‡¶ô ‡¶ï‡ßÄ?</option>
                </select>
            </div>
            <div class="auth-input-group">
                <label>‡¶â‡¶§‡ßç‡¶§‡¶∞</label>
                <input type="text" id="reg-sq-answer" placeholder="‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞" onkeydown="if(event.key==='Enter') doRegister()">
            </div>
            <button class="auth-btn" onclick="doRegister()">‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <div class="auth-error" id="reg-error"></div>
            <div class="auth-success" id="reg-success"></div>
        </div>

        <!-- Forgot PIN Form -->
        <div class="auth-form" id="forgot-form">
            <!-- Step 1: username input -->
            <div id="forgot-step1">
                <div style="font-size:13px; color:#555; margin-bottom:14px; text-align:center;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¶‡¶ø‡¶®</div>
                <div class="auth-input-group">
                    <label>‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ</label>
                    <input type="text" id="forgot-username" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ" onkeydown="if(event.key==='Enter') loadSecurityQuestion()">
                </div>
                <button class="auth-btn" onclick="loadSecurityQuestion()">‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶ß‡¶æ‡¶™ ‚Üí</button>
            </div>
            <!-- Step 2: security question answer -->
            <div id="forgot-step2" style="display:none;">
                <div class="security-question-display" id="forgot-sq-text"></div>
                <div class="auth-input-group">
                    <label>‡¶â‡¶§‡ßç‡¶§‡¶∞</label>
                    <input type="text" id="forgot-sq-answer" placeholder="‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞" onkeydown="if(event.key==='Enter') verifySecurityAnswer()">
                </div>
                <button class="auth-btn" onclick="verifySecurityAnswer()">‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶® ‚úì</button>
            </div>
            <!-- Step 3: new PIN -->
            <div id="forgot-step3" style="display:none;">
                <div style="font-size:13px; color:#2e7d32; font-weight:bold; text-align:center; margin-bottom:14px;">‚úÖ ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶∏‡¶´‡¶≤! ‡¶®‡¶§‡ßÅ‡¶® PIN ‡¶¶‡¶ø‡¶®</div>
                <div class="auth-input-group">
                    <label>‡¶®‡¶§‡ßÅ‡¶® PIN</label>
                    <input type="password" id="forgot-new-pin" maxlength="4" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡ß™ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ PIN">
                </div>
                <div class="auth-input-group">
                    <label>PIN ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                    <input type="password" id="forgot-new-pin2" maxlength="4" placeholder="‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" onkeydown="if(event.key==='Enter') doResetPin()">
                </div>
                <button class="auth-btn" onclick="doResetPin()">‡¶®‡¶§‡ßÅ‡¶® PIN ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
            <div class="auth-error" id="forgot-error"></div>
            <div class="auth-success" id="forgot-success"></div>
            <span class="forgot-link" onclick="switchAuthTab('login')" style="margin-top:8px;">‚Üê ‡¶≤‡¶ó‡¶á‡¶®‡ßá ‡¶´‡¶ø‡¶∞‡ßÅ‡¶®</span>
        </div>
    </div>
</div>

<div class="app-container" id="app-container" style="display:none">
    <div class="page-content" id="pageContent">
    <!-- Header -->
    <div class="header">
        <span class="user-indicator" id="user-indicator" onclick="toggleUserMenu(event)" title="‡¶Æ‡ßá‡¶®‡ßÅ">üë§ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</span>
        <!-- User Dropdown Menu -->
        <div id="user-dropdown" style="position:absolute;top:52px;left:10px;background:white;border-radius:12px;box-shadow:0 6px 24px rgba(0,0,0,0.18);min-width:170px;z-index:3000;display:none;overflow:hidden;">
            <div style="padding:10px 14px;font-size:12px;font-weight:700;color:#888;border-bottom:1px solid #f0f0f0;" id="user-dropdown-name"></div>
            <div onclick="setNewPin();closeUserMenu();" style="display:flex;align-items:center;gap:8px;padding:12px 14px;font-size:14px;font-weight:600;cursor:pointer;color:#333;transition:0.15s;" onmouseover="this.style.background='#f5f5f5'" onmouseout="this.style.background=''">
                <span>üîë</span> PIN ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®
            </div>
            <div onclick="logoutPrompt();closeUserMenu();" style="display:flex;align-items:center;gap:8px;padding:12px 14px;font-size:14px;font-weight:600;cursor:pointer;color:#e53935;border-top:1px solid #f0f0f0;transition:0.15s;" onmouseover="this.style.background='#fff5f5'" onmouseout="this.style.background=''">
                <span>üö™</span> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü
            </div>
        </div>
        ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨
        <span style="width:44px;"></span>
    </div>

    <!-- FIXED TOP SECTION -->
    <div class="fixed-top-section">
        <!-- Summary Cards -->
        <div class="summary">
            <!-- ‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ - ‡¶â‡¶™‡¶∞‡ßá ‡¶¨‡¶°‡¶º -->
            <div class="balance-card">
                <div class="balance-card-title" id="card-balance-title">‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</div>
                <div class="balance-card-amount" id="balance">‡ß≥‡ß¶</div>
            </div>
            <!-- ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Ü‡¶Ø‡¶º ‡¶ì ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º - ‡¶™‡¶æ‡¶∂‡¶æ‡¶™‡¶æ‡¶∂‡¶ø -->
            <div class="income-expense-row">
                <div class="card">
                    <div class="card-title" id="card-income-title">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Ü‡¶Ø‡¶º</div>
                    <div class="card-amount income" id="total-income">‡ß≥‡ß¶</div>
                </div>
                <div class="card">
                    <div class="card-title" id="card-expense-title">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º</div>
                    <div class="card-amount expense" id="total-expense">‡ß≥‡ß¶</div>
                </div>
            </div>
        </div>

        <!-- ‡¶π‡ßã‡¶Æ ‡¶≤‡ßá‡¶¨‡ßá‡¶≤ -->
        <div style="display:flex; align-items:center; justify-content:space-between; padding:8px 14px 6px; background:linear-gradient(90deg,rgba(0,128,128,0.07),transparent);">
            <div style="font-size:14px; font-weight:700; color:var(--balance-teal); letter-spacing:0.3px;">üìã ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®</div>
            <div id="today-date-label" style="font-size:14px; color:var(--balance-teal); font-weight:700;"></div>
        </div>
    </div>

    <!-- Budget Overview -->
    <div class="budget-section" id="budgetSection">
        <div class="budget-header">
            <span>üìä ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø</span>
            <span style="font-size:12px; color:var(--primary-pink); cursor:pointer;" onclick="openBudgetModal()">‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</span>
        </div>
        <div id="budgetBars"></div>
    </div>


    <!-- Transaction List (Home) -->
    <div class="list-section" id="list"></div>

    <!-- History Page -->
    <div id="page-history" style="display:none; padding:0; height:100%;">
        <!-- ‡¶´‡ßç‡¶∞‡¶ø‡¶ú‡¶° ‡¶ü‡¶™ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® (‡¶∏‡ßç‡¶ü‡¶ø‡¶ï‡¶ø) -->
        <div style="position:sticky; top:0; z-index:50; background:var(--bg-light); padding:12px 12px 0;">
        <!-- ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® -->
        <div class="view-selection" style="margin-bottom:-10px; padding:8px 0; background:transparent; box-shadow:none;">
            <div class="view-buttons" style="grid-template-columns:repeat(3,1fr);">
                <button class="view-btn active" id="hist-btn-monthly" onclick="setHistView(event,'monthly')">‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï</button>
                <button class="view-btn" id="hist-btn-yearly" onclick="setHistView(event,'yearly')">‡¶¨‡¶æ‡¶∞‡ßç‡¶∑‡¶ø‡¶ï</button>
                <button class="view-btn" id="hist-btn-custom" onclick="setHistView(event,'custom')">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ</button>
            </div>
            <div class="filter-controls">
                <div class="filter-row" id="hist-monthly-filter" style="display:flex">
                    <select id="filter-month"></select>
                    <select id="filter-year"></select>
                </div>
                <div class="filter-row" id="hist-yearly-filter" style="display:none">
                    <select id="filter-year-only"></select>
                </div>
                <div id="hist-custom-filter" style="display:none">
                    <div class="filter-row">
                        <input type="date" id="filter-start-date">
                        <input type="date" id="filter-end-date">
                    </div>
                </div>
            </div>
        </div>
        <!-- ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° -->
        <div class="summary" style="margin-bottom:10px; padding:0; display:grid; grid-template-columns:repeat(3,1fr); gap:8px;">
            <div class="card"><div class="card-title" id="hist-income-title">‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶Ü‡¶Ø‡¶º</div><div class="card-amount income" id="hist-total-income">‡ß≥‡ß¶</div></div>
            <div class="card"><div class="card-title" id="hist-expense-title">‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º</div><div class="card-amount expense" id="hist-total-expense">‡ß≥‡ß¶</div></div>
            <div class="card"><div class="card-title" id="hist-balance-title">‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</div><div class="card-amount balance" id="hist-balance">‡ß≥‡ß¶</div></div>
        </div>
        <!-- ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö -->
        <div class="search-bar" style="margin:0 0 10px;">
            <span>üîç</span>
            <input type="text" id="history-search" placeholder="‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." oninput="renderHistory()">
            <span style="cursor:pointer;color:#aaa;font-size:14px;" onclick="document.getElementById('history-search').value='';renderHistory()">‚úï</span>
        </div>
        </div><!-- /sticky top -->
        <!-- ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡ßã‡¶≤‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü -->
        <div id="history-list" style="padding:0 12px 12px; overflow-y:auto; flex:1;"></div>
    </div>

    <!-- Analytics Page -->
    <div id="page-analytics" style="display:none; padding:12px;">
        <div style="font-size:15px; font-weight:bold; margin-bottom:12px; color:#333;">üìä ‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£</div>
        <div class="chart-section" style="margin:0 0 12px;">
            <div class="chart-header">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º</div>
            <div class="chart-content">
                <div class="chart-container"><canvas id="categoryChart"></canvas></div>
                <div class="category-list" id="categoryList"></div>
            </div>
        </div>
        <div class="chart-section" style="margin:0;">
            <div class="chart-header" style="margin-bottom:12px;">üìà ‡¶Æ‡¶æ‡¶∏‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶Ü‡¶Ø‡¶º ‡¶ì ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º</div>
            <canvas id="barChartInline" style="max-height:220px;"></canvas>
        </div>
    </div>

    <!-- Settings Page -->
    <div id="page-settings" style="display:none; padding:12px;">
        <div style="font-size:15px; font-weight:bold; margin-bottom:12px; color:#333;">‚öôÔ∏è ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</div>
        <div class="settings-list">
            <div class="settings-item" onclick="toggleDarkMode()">
                <span>üåô</span><span id="darkModeLabel">‡¶°‡¶æ‡¶∞‡ßç‡¶ï ‡¶Æ‡ßã‡¶°</span><span>‚Ä∫</span>
            </div>
            <div class="settings-item" onclick="openBudgetModal()">
                <span>üìä</span><span>‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶£</span><span>‚Ä∫</span>
            </div>
            <div class="settings-item" onclick="openCategoryPanel()">
                <span>üè∑Ô∏è</span><span>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</span><span>‚Ä∫</span>
            </div>
            <div class="settings-item" onclick="exportPDF()">
                <span>üìÑ</span><span>PDF ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</span><span>‚Ä∫</span>
            </div>
            <div class="settings-item" onclick="shareSummary()">
                <span>üì§</span><span>‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞</span><span>‚Ä∫</span>
            </div>
            <div class="settings-item" onclick="createBackup()">
                <span>üíæ</span><span>‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</span><span>‚Ä∫</span>
            </div>
            <label class="settings-item" for="restore-file2">
                <span>‚ôªÔ∏è</span><span>‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</span><span>‚Ä∫</span>
                <input type="file" id="restore-file2" accept=".json" onchange="restoreBackup(event)" style="display:none">
            </label>
            <div class="settings-item" onclick="exportToExcel()">
                <span>üìä</span><span>‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</span><span>‚Ä∫</span>
            </div>
            <div class="settings-item" onclick="setNewPin()">
                <span>üîë</span><span>PIN ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</span><span>‚Ä∫</span>
            </div>
            <div class="settings-item" onclick="logoutPrompt()">
                <span>üö™</span><span>‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</span><span>‚Ä∫</span>
            </div>
        </div>
        <div style="text-align:center; margin-top:16px; font-size:11px; color:#aaa;">‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ v2.0</div>
    </div>

    </div><!-- /page-content -->

    <nav class="bottom-nav">
        <button class="nav-item active" id="nav-home" onclick="switchTab('home')">
            <div class="nav-icon-wrap"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg></div>
            <span>‡¶π‡ßã‡¶Æ</span>
        </button>
        <button class="nav-item" id="nav-history" onclick="switchTab('history')">
            <div class="nav-icon-wrap"><svg viewBox="0 0 24 24"><path d="M13 3a9 9 0 0 0-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.954 8.954 0 0 0 13 21a9 9 0 0 0 0-18zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/></svg></div>
            <span>‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</span>
        </button>
        <!-- spacer for center FAB -->
        <div style="flex:1;"></div>
        <button class="nav-item" id="nav-analytics" onclick="switchTab('analytics')">
            <div class="nav-icon-wrap"><svg viewBox="0 0 24 24"><path d="M7 17h2v-7H7v7zm4 0h2V7h-2v10zm4 0h2v-4h-2v4zM5 3v18h14V3H5zm12 16H7V5h10v14z"/></svg></div>
            <span>‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£</span>
        </button>
        <button class="nav-item" id="nav-settings" onclick="switchTab('settings')">
            <div class="nav-icon-wrap"><svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94s-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.56-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg></div>
            <span>‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</span>
        </button>
        <!-- Floating center add button (absolute) -->
        <button class="nav-add-btn" onclick="openEntryPanel()">
            <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
        </button>
    </nav>

</div><!-- /app-container -->

<!-- Entry Panel (NEW) -->
<div class="entry-panel" id="entryPanel">
    <div class="entry-panel-content">
        <span class="close-panel" onclick="closeEntryPanel()">√ó</span>
        <h2 style="text-align: center; margin-top: 0;">‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
        
        <div class="entry-tabs">
            <button class="entry-tab active" onclick="switchEntryTab(event, 'income')">‡¶Ü‡¶Ø‡¶º</button>
            <button class="entry-tab" onclick="switchEntryTab(event, 'expense')">‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º</button>
        </div>

        <!-- Income Form -->
        <div class="entry-form active" id="income-form">
            <div class="form-group">
                <input type="number" id="income-amount" placeholder="‡ß≥ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
            </div>
            <div class="form-group">
                <input type="text" id="income-title" placeholder="‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
            </div>
            <div class="form-group">
                <select id="income-category"></select>
            </div>
            <div class="form-group">
                <textarea id="income-note" placeholder="‡¶®‡ßã‡¶ü (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)..."></textarea>
            </div>
            <div class="form-group">
                <input type="date" id="income-date">
            </div>
            <button class="submit-btn" onclick="submitEntry('income')">‡¶Ü‡¶Ø‡¶º ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>

        <!-- Expense Form -->
        <div class="entry-form" id="expense-form">
            <div class="form-group">
                <input type="number" id="expense-amount" placeholder="‡ß≥ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
            </div>
            <div class="form-group">
                <input type="text" id="expense-title" placeholder="‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
            </div>
            <div class="form-group">
                <select id="expense-category"></select>
            </div>
            <div class="form-group">
                <textarea id="expense-note" placeholder="‡¶®‡ßã‡¶ü (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)..."></textarea>
            </div>
            <div class="form-group">
                <input type="date" id="expense-date">
            </div>
            <button class="submit-btn" onclick="submitEntry('expense')">‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>
</div>

<!-- Category Management Panel -->
<div class="category-panel" id="categoryPanel">
    <div class="category-panel-content">
        <span class="close-panel" onclick="closeCategoryPanel()">√ó</span>
        <h2 style="text-align: center; margin-top: 0;">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</h2>
        
        <div class="cat-tabs">
            <button class="cat-tab active" onclick="switchCatTab(event, 'income')">‡¶Ü‡¶Ø‡¶º</button>
            <button class="cat-tab" onclick="switchCatTab(event, 'expense')">‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º</button>
        </div>

        <div class="cat-list" id="catListIncome"></div>
        <div class="cat-list" id="catListExpense" style="display:none"></div>

        <div class="cat-add-section">
            <h4>‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
            <div class="cat-add-inputs">
                <input type="text" id="newCatName" placeholder="‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ">
                <input type="color" id="newCatColor" value="#e91e63">
            </div>
            <button class="cat-add-btn" onclick="addCategory()">‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>
</div>

<!-- Edit Modal -->
<div class="edit-modal" id="editModal">
    <div class="edit-modal-content">
        <span class="close-panel" onclick="closeEditModal()">√ó</span>
        <div class="edit-modal-title">‚úèÔ∏è ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</div>

        <div class="form-group">
            <label>‡¶ß‡¶∞‡¶®</label>
            <select id="edit-type">
                <option value="income">‡¶Ü‡¶Ø‡¶º</option>
                <option value="expense">‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º</option>
            </select>
        </div>
        <div class="form-group">
            <label>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡ß≥)</label>
            <input type="number" id="edit-amount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£">
        </div>
        <div class="form-group">
            <label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</label>
            <input type="text" id="edit-title" placeholder="‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
        </div>
        <div class="form-group">
            <label>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</label>
            <select id="edit-category"></select>
        </div>
        <div class="form-group">
            <label>‡¶®‡ßã‡¶ü (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
            <textarea id="edit-note" placeholder="‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶®‡ßã‡¶ü..."></textarea>
        </div>
        <div class="form-group">
            <label>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
            <input type="date" id="edit-date">
        </div>
        <button class="submit-btn" onclick="saveEdit()">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
</div>

<!-- Side Menu -->
<div class="menu-overlay" id="overlay" onclick="toggleMenu()"></div>
<div class="side-menu" id="sideMenu">
    <div style="display:flex;align-items:center;background:#f1f3f5;border-radius:12px;padding:10px 12px;gap:8px;margin-bottom:4px;border:1.5px solid #dee2e6;">
        <span style="color:#aaa;font-size:16px;">üîç</span>
        <input type="text" id="search-input" placeholder="‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." oninput="render()" style="flex:1;border:none;outline:none;font-size:14px;background:transparent;color:#333;">
        <span id="search-clear" style="cursor:pointer;display:none;color:#aaa;font-size:14px;" onclick="clearSearch()">‚úï</span>
    </div>
    <div class="menu-item" onclick="openBudgetModal(); toggleMenu();">üìä ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶£</div>
    <div class="menu-item" onclick="openBarChartModal(); toggleMenu();">üìà ‡¶Æ‡¶æ‡¶∏‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</div>
    <div class="menu-item" onclick="openCategoryPanel(); toggleMenu();">üè∑Ô∏è ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</div>
    <div class="menu-item" onclick="exportPDF(); toggleMenu();">üìÑ PDF ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</div>
    <div class="menu-item" onclick="shareSummary(); toggleMenu();">üì§ ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞</div>
    <div class="menu-item" onclick="createBackup(); toggleMenu();">üíæ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</div>
    <label class="menu-item" for="restore-file">‚ôªÔ∏è ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
        <input type="file" id="restore-file" accept=".json" onchange="restoreBackup(event); toggleMenu();" style="display:none">
    </label>
    <div class="menu-item" onclick="exportToExcel(); toggleMenu();">üìä ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</div>
    <div class="menu-item" onclick="setNewPin(); toggleMenu();">üîë PIN ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</div>
</div>

<script>

    // ‚îÄ‚îÄ Supabase Config ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const SUPABASE_URL = 'https://tlxovepgtwtsyesgkkim.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_xpsqJtRcTQyW8Z9mvSwF8w_21khY9BH';
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // ‚îÄ‚îÄ Global State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let transactions = [];
    let currentUser = null;
    let budgets = {};
    let barChartInstance = null;
    let darkMode = false;
    let userPin = '';
    let currentCatType = 'income';
    let currentEntryType = 'income';
    let categoryChart = null;
    let categories = {};
    let currentTab = 'home';
    let barChartInlineInstance = null;
    let histView = 'monthly';

    // ‚îÄ‚îÄ Loading Overlay ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function showLoading(msg = '‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...') {
        let ov = document.getElementById('loading-overlay');
        if (!ov) {
            ov = document.createElement('div');
            ov.id = 'loading-overlay';
            ov.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:9999;display:flex;align-items:center;justify-content:center;';
            ov.innerHTML = `<div style="background:white;padding:24px 32px;border-radius:16px;text-align:center;font-size:15px;font-weight:600;color:#333;">${msg}</div>`;
            document.body.appendChild(ov);
        } else {
            ov.querySelector('div').textContent = msg;
            ov.style.display = 'flex';
        }
    }
    function hideLoading() {
        const ov = document.getElementById('loading-overlay');
        if (ov) ov.style.display = 'none';
    }

    // ‚îÄ‚îÄ User Dropdown ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function toggleUserMenu(e) {
        e.stopPropagation();
        const dd = document.getElementById('user-dropdown');
        dd.style.display = dd.style.display === 'none' ? 'block' : 'none';
    }
    function closeUserMenu() {
        document.getElementById('user-dropdown').style.display = 'none';
    }
    document.addEventListener('click', function() { closeUserMenu(); });

    // ‚îÄ‚îÄ Default Categories ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const defaultCategories = {
        income: [
            { name: '‡¶¨‡ßá‡¶§‡¶®', color: '#4CAF50' },
            { name: '‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ', color: '#2196F3' },
            { name: '‡¶¨‡ßã‡¶®‡¶æ‡¶∏', color: '#FF9800' },
            { name: '‡¶â‡¶™‡¶π‡¶æ‡¶∞', color: '#9C27B0' },
            { name: '‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø', color: '#607D8B' }
        ],
        expense: [
            { name: '‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞', color: '#F44336' },
            { name: '‡¶Ø‡¶æ‡¶§‡¶æ‡¶Ø‡¶º‡¶æ‡¶§', color: '#FF5722' },
            { name: '‡¶¨‡¶ø‡¶≤', color: '#795548' },
            { name: '‡¶∂‡¶™‡¶ø‡¶Ç', color: '#E91E63' },
            { name: '‡¶ö‡¶ø‡¶ï‡¶ø‡ßé‡¶∏‡¶æ', color: '#009688' },
            { name: '‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®', color: '#3F51B5' },
            { name: '‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ', color: '#00BCD4' },
            { name: '‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø', color: '#9E9E9E' }
        ]
    };

    // ‚îÄ‚îÄ Auth ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function switchAuthTab(tab) {
        document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
        if (tab === 'login') {
            document.querySelector('.auth-tab:nth-child(1)').classList.add('active');
            document.getElementById('login-form').classList.add('active');
        } else if (tab === 'register') {
            document.querySelector('.auth-tab:nth-child(2)').classList.add('active');
            document.getElementById('register-form').classList.add('active');
        } else if (tab === 'forgot') {
            document.getElementById('forgot-form').classList.add('active');
        }
    }

    function showForgotForm() {
        document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
        document.getElementById('forgot-form').classList.add('active');
        document.getElementById('forgot-error').textContent = '';
        document.getElementById('forgot-success').textContent = '';
        document.getElementById('forgot-step1').style.display = 'block';
        document.getElementById('forgot-step2').style.display = 'none';
        document.getElementById('forgot-step3').style.display = 'none';
        document.getElementById('forgot-username').value = '';
        forgotVerifiedUser = null;
    }

    let forgotVerifiedUser = null;

    async function loadSecurityQuestion() {
        const username = document.getElementById('forgot-username').value.trim().toLowerCase();
        const errEl = document.getElementById('forgot-error');
        errEl.textContent = '';
        if (!username) { errEl.textContent = '‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¶‡¶ø‡¶®'; return; }
        showLoading('‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶õ‡¶ø...');
        const { data, error } = await sb.from('users').select('security_question').eq('username', username).single();
        hideLoading();
        if (error || !data) { errEl.textContent = '‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø'; return; }
        if (!data.security_question) { errEl.textContent = '‡¶è‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶®‡ßá‡¶á'; return; }
        forgotVerifiedUser = username;
        document.getElementById('forgot-sq-text').textContent = '‚ùì ' + data.security_question;
        document.getElementById('forgot-step1').style.display = 'none';
        document.getElementById('forgot-step2').style.display = 'block';
        document.getElementById('forgot-sq-answer').value = '';
        document.getElementById('forgot-sq-answer').focus();
    }

    async function verifySecurityAnswer() {
        const answer = document.getElementById('forgot-sq-answer').value.trim();
        const errEl = document.getElementById('forgot-error');
        errEl.textContent = '';
        if (!answer) { errEl.textContent = '‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡¶ø‡¶®'; return; }
        showLoading('‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶õ‡¶ø...');
        const { data } = await sb.from('users').select('security_answer').eq('username', forgotVerifiedUser).single();
        hideLoading();
        if (!data || answer.toLowerCase() !== data.security_answer.toLowerCase().trim()) {
            errEl.textContent = '‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡¶Ø‡¶º, ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®';
            return;
        }
        document.getElementById('forgot-step2').style.display = 'none';
        document.getElementById('forgot-step3').style.display = 'block';
        document.getElementById('forgot-new-pin').focus();
    }

    async function doResetPin() {
        const newPin = document.getElementById('forgot-new-pin').value;
        const newPin2 = document.getElementById('forgot-new-pin2').value;
        const errEl = document.getElementById('forgot-error');
        const succEl = document.getElementById('forgot-success');
        errEl.textContent = '';
        if (!newPin || newPin.length !== 4 || !/^\d+$/.test(newPin)) { errEl.textContent = 'PIN ‡¶†‡¶ø‡¶ï ‡ß™‡¶ü‡¶ø ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá'; return; }
        if (newPin !== newPin2) { errEl.textContent = 'PIN ‡¶¶‡ßÅ‡¶ü‡¶ø ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ'; return; }
        showLoading('‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶õ‡¶ø...');
        await sb.from('users').update({ pin: newPin }).eq('username', forgotVerifiedUser);
        hideLoading();
        succEl.textContent = 'üéâ PIN ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!';
        forgotVerifiedUser = null;
        setTimeout(() => switchAuthTab('login'), 1800);
    }

    async function doLogin() {
        const username = document.getElementById('login-username').value.trim().toLowerCase();
        const pin = document.getElementById('login-pin').value;
        const errEl = document.getElementById('login-error');
        errEl.textContent = '';
        if (!username) { errEl.textContent = '‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¶‡¶ø‡¶®'; return; }
        if (!pin || pin.length !== 4) { errEl.textContent = '‡¶∏‡¶†‡¶ø‡¶ï ‡ß™ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ PIN ‡¶¶‡¶ø‡¶®'; return; }
        showLoading('‡¶≤‡¶ó‡¶á‡¶® ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');
        const { data, error } = await sb.from('users').select('*').eq('username', username).single();
        if (error || !data) { hideLoading(); errEl.textContent = '‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø'; return; }
        if (data.pin !== pin) { hideLoading(); errEl.textContent = 'PIN ‡¶≠‡ßÅ‡¶≤ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá'; return; }
        currentUser = { username: data.username, displayName: data.display_name };
        userPin = data.pin;
        document.getElementById('auth-screen').style.display = 'none';
        await init();
        hideLoading();
    }

    async function doRegister() {
        const username = document.getElementById('reg-username').value.trim();
        const pin = document.getElementById('reg-pin').value;
        const pin2 = document.getElementById('reg-pin2').value;
        const secQuestion = document.getElementById('reg-sq').value;
        const secAnswer = document.getElementById('reg-sq-answer').value.trim();
        const errEl = document.getElementById('reg-error');
        const succEl = document.getElementById('reg-success');
        errEl.textContent = ''; succEl.textContent = '';

        if (!username || username.length < 3) { errEl.textContent = '‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß© ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá'; return; }
        if (!/^[a-zA-Z0-9_\u0980-\u09FF]+$/.test(username)) { errEl.textContent = '‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞, ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶¨‡¶æ _ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®'; return; }
        if (!pin || pin.length !== 4 || !/^\d+$/.test(pin)) { errEl.textContent = 'PIN ‡¶†‡¶ø‡¶ï ‡ß™‡¶ü‡¶ø ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá'; return; }
        if (pin !== pin2) { errEl.textContent = 'PIN ‡¶¶‡ßÅ‡¶ü‡¶ø ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ'; return; }
        if (!secQuestion) { errEl.textContent = '‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡¶ø‡¶®'; return; }
        if (!secAnswer || secAnswer.length < 2) { errEl.textContent = '‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡¶ø‡¶®'; return; }

        showLoading('‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶® ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');
        const { error } = await sb.from('users').insert({
            username: username.toLowerCase(),
            display_name: username,
            pin,
            security_question: secQuestion,
            security_answer: secAnswer
        });
        hideLoading();

        if (error) {
            if (error.code === '23505') errEl.textContent = '‡¶è‡¶á ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶Ü‡¶ó‡ßá‡¶á ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá';
            else errEl.textContent = '‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ' + error.message;
            return;
        }

        // Default categories ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ
        const catRows = [];
        defaultCategories.income.forEach(c => catRows.push({ username: username.toLowerCase(), type: 'income', name: c.name, color: c.color }));
        defaultCategories.expense.forEach(c => catRows.push({ username: username.toLowerCase(), type: 'expense', name: c.name, color: c.color }));
        await sb.from('categories').insert(catRows);

        succEl.textContent = '‚úÖ ‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶® ‡¶∏‡¶´‡¶≤! ‡¶è‡¶ñ‡¶® ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§';
        document.getElementById('reg-username').value = '';
        document.getElementById('reg-pin').value = '';
        document.getElementById('reg-pin2').value = '';
        document.getElementById('reg-sq').value = '';
        document.getElementById('reg-sq-answer').value = '';
        setTimeout(() => switchAuthTab('login'), 1500);
    }

    async function logoutPrompt() {
        if (confirm(`${currentUser.displayName} ‚Äî ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?`)) {
            currentUser = null;
            transactions = [];
            budgets = {};
            categories = {};
            document.getElementById('auth-screen').style.display = 'flex';
            document.getElementById('app-container').style.display = 'none';
            document.getElementById('login-username').value = '';
            document.getElementById('login-pin').value = '';
            document.getElementById('login-error').textContent = '';
            if (categoryChart) { categoryChart.destroy(); categoryChart = null; }
            if (barChartInstance) { barChartInstance.destroy(); barChartInstance = null; }
        }
    }

    // ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function init() {
        showLoading('‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');

        // Transactions
        const { data: txData } = await sb.from('transactions').select('*').eq('username', currentUser.username).order('date', { ascending: false });
        transactions = txData || [];

        // Categories
        const { data: catData } = await sb.from('categories').select('*').eq('username', currentUser.username);
        if (catData && catData.length > 0) {
            categories = { income: [], expense: [] };
            catData.forEach(c => {
                if (c.type === 'income') categories.income.push({ name: c.name, color: c.color });
                else categories.expense.push({ name: c.name, color: c.color });
            });
        } else {
            categories = JSON.parse(JSON.stringify(defaultCategories));
        }

        // Budgets
        const { data: budData } = await sb.from('budgets').select('*').eq('username', currentUser.username);
        budgets = {};
        if (budData) budData.forEach(b => { budgets[b.category] = b.amount; });

        document.getElementById('app-container').style.display = '';
        document.getElementById('user-indicator').textContent = 'üë§ ' + currentUser.displayName;
        const ddn = document.getElementById('user-dropdown-name');
        if (ddn) ddn.textContent = 'üë§ ' + currentUser.displayName;

        populateFilters();
        populateCategorySelects();
        renderCategoryLists();
        setTodayDate();
        render();
        renderBudgetSection();
        hideLoading();
    }

    // ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function setTodayDate() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('income-date').value = today;
        document.getElementById('expense-date').value = today;
    }

    function populateFilters() {
        const months = ['‡¶ú‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø','‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø','‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö','‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤','‡¶Æ‡ßá','‡¶ú‡ßÅ‡¶®','‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á','‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü','‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞','‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞','‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞','‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞'];
        const monthSelect = document.getElementById('filter-month');
        const yearSelect = document.getElementById('filter-year');
        const yearOnlySelect = document.getElementById('filter-year-only');
        const now = new Date();
        const currentMonth = now.getMonth();
        const currentYear = now.getFullYear();

        monthSelect.innerHTML = '';
        months.forEach((m, i) => {
            monthSelect.innerHTML += `<option value="${i}" ${i===currentMonth?'selected':''}>${m}</option>`;
        });
        yearSelect.innerHTML = '';
        yearOnlySelect.innerHTML = '';
        for (let y = currentYear; y >= currentYear - 10; y--) {
            yearSelect.innerHTML += `<option value="${y}" ${y===currentYear?'selected':''}>${y}</option>`;
            yearOnlySelect.innerHTML += `<option value="${y}" ${y===currentYear?'selected':''}>${y}</option>`;
        }
        monthSelect.onchange = renderHistory;
        yearSelect.onchange = renderHistory;
        yearOnlySelect.onchange = renderHistory;
        document.getElementById('filter-start-date').onchange = renderHistory;
        document.getElementById('filter-end-date').onchange = renderHistory;
    }

    function populateCategorySelects() {
        const incomeSelect = document.getElementById('income-category');
        const expenseSelect = document.getElementById('expense-category');
        incomeSelect.innerHTML = '<option value="">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
        categories.income.forEach(cat => {
            incomeSelect.innerHTML += `<option value="${cat.name}">${escapeHtml(cat.name)}</option>`;
        });
        expenseSelect.innerHTML = '<option value="">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
        categories.expense.forEach(cat => {
            expenseSelect.innerHTML += `<option value="${cat.name}">${escapeHtml(cat.name)}</option>`;
        });
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function formatDate(dateStr) {
        const months = ['‡¶ú‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø','‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø','‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö','‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤','‡¶Æ‡ßá','‡¶ú‡ßÅ‡¶®','‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á','‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü','‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞','‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞','‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞','‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞'];
        const d = new Date(dateStr + 'T00:00:00');
        return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}`;
    }

    function getCategoryColor(categoryName) {
        for (let cat of categories.income) { if (cat.name === categoryName) return cat.color; }
        for (let cat of categories.expense) { if (cat.name === categoryName) return cat.color; }
        return '#999';
    }

    // ‚îÄ‚îÄ Entry Panel ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function openEntryPanel() {
        document.getElementById('entryPanel').classList.add('active');
    }
    function closeEntryPanel() {
        document.getElementById('entryPanel').classList.remove('active');
        clearEntryForms();
    }
    function clearEntryForms() {
        ['income-amount','income-title','income-note','expense-amount','expense-title','expense-note'].forEach(id => {
            document.getElementById(id).value = '';
        });
        document.getElementById('income-category').value = '';
        document.getElementById('expense-category').value = '';
        setTodayDate();
    }
    function switchEntryTab(event, type) {
        currentEntryType = type;
        document.querySelectorAll('.entry-tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
        document.getElementById('income-form').classList.remove('active');
        document.getElementById('expense-form').classList.remove('active');
        document.getElementById(type + '-form').classList.add('active');
    }

    async function submitEntry(type) {
        const amount = parseFloat(document.getElementById(`${type}-amount`).value);
        const title = document.getElementById(`${type}-title`).value.trim();
        const category = document.getElementById(`${type}-category`).value;
        const dateStr = document.getElementById(`${type}-date`).value;
        const note = document.getElementById(`${type}-note`).value.trim();

        if (!amount || amount <= 0) { alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶¶‡¶ø‡¶®'); return; }
        if (!title) { alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶¶‡¶ø‡¶®'); return; }
        if (!category) { alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®'); return; }
        if (!dateStr) { alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®'); return; }

        const newTx = {
            id: Date.now().toString(),
            username: currentUser.username,
            date: dateStr,
            type,
            amount,
            title,
            category,
            note
        };

        showLoading('‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');
        const { error } = await sb.from('transactions').insert(newTx);
        hideLoading();

        if (error) { alert('‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ' + error.message); return; }

        transactions.unshift(newTx);
        render();
        closeEntryPanel();
        alert(`${type === 'income' ? '‡¶Ü‡¶Ø‡¶º' : '‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º'} ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`);
    }

    // ‚îÄ‚îÄ Category Panel ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function openCategoryPanel() {
        document.getElementById('categoryPanel').classList.add('active');
        renderCategoryLists();
    }
    function closeCategoryPanel() {
        document.getElementById('categoryPanel').classList.remove('active');
    }
    function switchCatTab(event, type) {
        currentCatType = type;
        document.querySelectorAll('.cat-tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
        document.getElementById('catListIncome').style.display = type === 'income' ? 'block' : 'none';
        document.getElementById('catListExpense').style.display = type === 'expense' ? 'block' : 'none';
    }
    function renderCategoryLists() {
        ['income','expense'].forEach(type => {
            const el = document.getElementById('catList' + (type === 'income' ? 'Income' : 'Expense'));
            el.innerHTML = '';
            categories[type].forEach((cat, index) => {
                el.innerHTML += `<div class="cat-item">
                    <div class="cat-item-info">
                        <span class="cat-color-dot" style="background-color:${cat.color}"></span>
                        <span>${escapeHtml(cat.name)}</span>
                    </div>
                    <div class="cat-actions">
                        <button class="cat-edit-btn" onclick="editCategory('${type}',${index})">‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</button>
                        <button class="cat-delete-btn" onclick="deleteCategory('${type}',${index})">‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                    </div>
                </div>`;
            });
        });
    }

    async function addCategory() {
        const name = document.getElementById('newCatName').value.trim();
        const color = document.getElementById('newCatColor').value;
        if (!name) { alert('‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®'); return; }
        if (categories[currentCatType].some(c => c.name.toLowerCase() === name.toLowerCase())) {
            alert('‡¶è‡¶á ‡¶®‡¶æ‡¶Æ‡ßá ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá‡¶á ‡¶Ü‡¶õ‡ßá'); return;
        }
        showLoading('‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');
        const { error } = await sb.from('categories').insert({ username: currentUser.username, type: currentCatType, name, color });
        hideLoading();
        if (error) { alert('‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá'); return; }
        categories[currentCatType].push({ name, color });
        populateCategorySelects();
        renderCategoryLists();
        document.getElementById('newCatName').value = '';
        document.getElementById('newCatColor').value = '#e91e63';
        alert('‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
    }

    async function editCategory(type, index) {
        const cat = categories[type][index];
        const newName = prompt('‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡¶æ‡¶Æ:', cat.name);
        if (!newName || !newName.trim()) return;
        showLoading('‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');
        await sb.from('categories').update({ name: newName.trim() })
            .eq('username', currentUser.username).eq('type', type).eq('name', cat.name);
        hideLoading();
        categories[type][index].name = newName.trim();
        populateCategorySelects();
        renderCategoryLists();
        render();
    }

    async function deleteCategory(type, index) {
        if (!confirm('‡¶è‡¶á ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®?')) return;
        const cat = categories[type][index];
        showLoading('‡¶Æ‡ßÅ‡¶õ‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');
        await sb.from('categories').delete().eq('username', currentUser.username).eq('type', type).eq('name', cat.name);
        hideLoading();
        categories[type].splice(index, 1);
        populateCategorySelects();
        renderCategoryLists();
        render();
    }

    // ‚îÄ‚îÄ Render Home ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function updateCardTitles() {
        document.getElementById('card-income-title').textContent = '‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Ü‡¶Ø‡¶º';
        document.getElementById('card-expense-title').textContent = '‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º';
        document.getElementById('card-balance-title').textContent = '‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏';
    }

    function render() {
        const list = document.getElementById('list');
        const todayStr = new Date().toISOString().split('T')[0];
        let listData = transactions.filter(item => item.date === todayStr);

        // Search
        const searchQ = document.getElementById('search-input') ? document.getElementById('search-input').value.trim().toLowerCase() : '';
        const clearBtn = document.getElementById('search-clear');
        if (clearBtn) clearBtn.style.display = searchQ ? 'inline' : 'none';
        if (searchQ) {
            listData = listData.filter(item =>
                item.title.toLowerCase().includes(searchQ) ||
                (item.category || '').toLowerCase().includes(searchQ) ||
                (item.note || '').toLowerCase().includes(searchQ)
            );
        }

        list.innerHTML = '';
        [...listData].forEach(item => {
            const typeText = item.type === 'income' ? '‡¶Ü‡¶Ø‡¶º' : '‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º';
            const category = item.category || '‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£';
            list.innerHTML += `<div class="item" style="border-left-color:${item.type==='income'?'var(--income-green)':'var(--expense-red)'}">
                <div style="flex:1;">
                    <b>${escapeHtml(item.title)}</b><span class="cat-badge">${escapeHtml(category)}</span>
                    <br><small style="color:#888">${formatDate(item.date)}</small>
                    ${item.note ? `<div class="item-note">üìù ${escapeHtml(item.note)}</div>` : ''}
                </div>
                <div style="text-align:right;white-space:nowrap;display:flex;align-items:center;gap:2px;">
                    <div style="color:${item.type==='income'?'var(--income-green)':'var(--expense-red)'};font-weight:bold">${typeText} ‡ß≥${item.amount.toLocaleString('bn-BD')}</div>
                    <div class="item-actions">
                        <button class="three-dot-btn" onclick="toggleDropdown(event,'${item.id}')">‚ãÆ</button>
                        <div class="dropdown-menu" id="dd-${item.id}">
                            <button class="dropdown-item edit" onclick="openEditModal('${item.id}');closeAllDropdowns()">‚úèÔ∏è ‡¶è‡¶°‡¶ø‡¶ü</button>
                            <div class="dropdown-divider"></div>
                            <button class="dropdown-item delete" onclick="deleteWithPin('${item.id}');closeAllDropdowns()">üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                        </div>
                    </div>
                </div>
            </div>`;
        });

        if (listData.length === 0) list.innerHTML = '<p class="empty-state">‡¶ï‡ßã‡¶®‡ßã ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶®‡ßá‡¶á</p>';

        // Summary cards
        const todayData = transactions.filter(i => i.date === todayStr);
        const todayIncome = todayData.filter(i => i.type === 'income').reduce((s,i) => s+i.amount, 0);
        const todayExpense = todayData.filter(i => i.type === 'expense').reduce((s,i) => s+i.amount, 0);
        const allIncome = transactions.filter(i => i.type === 'income').reduce((s,i) => s+i.amount, 0);
        const allExpense = transactions.filter(i => i.type === 'expense').reduce((s,i) => s+i.amount, 0);

        document.getElementById('total-income').textContent = '‡ß≥' + todayIncome.toLocaleString('bn-BD');
        document.getElementById('total-expense').textContent = '‡ß≥' + todayExpense.toLocaleString('bn-BD');
        document.getElementById('balance').textContent = '‡ß≥' + (allIncome - allExpense).toLocaleString('bn-BD');

        const todayLabelEl = document.getElementById('today-date-label');
        if (todayLabelEl) {
            const days = ['‡¶∞‡¶¨‡¶ø‡¶¨‡¶æ‡¶∞','‡¶∏‡ßã‡¶Æ‡¶¨‡¶æ‡¶∞','‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤‡¶¨‡¶æ‡¶∞','‡¶¨‡ßÅ‡¶ß‡¶¨‡¶æ‡¶∞','‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø‡¶¨‡¶æ‡¶∞','‡¶∂‡ßÅ‡¶ï‡ßç‡¶∞‡¶¨‡¶æ‡¶∞','‡¶∂‡¶®‡¶ø‡¶¨‡¶æ‡¶∞'];
            const months = ['‡¶ú‡¶æ‡¶®‡ßÅ','‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ','‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö','‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤','‡¶Æ‡ßá','‡¶ú‡ßÅ‡¶®','‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á','‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü','‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá','‡¶Ö‡¶ï‡ßç‡¶ü‡ßã','‡¶®‡¶≠‡ßá','‡¶°‡¶ø‡¶∏‡ßá'];
            const d = new Date();
            todayLabelEl.textContent = days[d.getDay()] + ', ' + d.getDate() + ' ' + months[d.getMonth()] + ' ' + d.getFullYear();
        }

        updateChartAndList(listData);
        updateCardTitles();
        renderBudgetSection();
        if (currentTab === 'history') renderHistory();
    }

    // ‚îÄ‚îÄ Chart ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function updateChartAndList(listData) {
        const expenseStats = {};
        listData.forEach(item => {
            if (item.type !== 'expense') return;
            const cat = item.category || '‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£';
            if (!expenseStats[cat]) expenseStats[cat] = { amount: 0 };
            expenseStats[cat].amount += item.amount;
        });

        const totalExpense = listData.filter(i => i.type === 'expense').reduce((s,i) => s+i.amount, 0);
        const labels = Object.keys(expenseStats);
        const chartData = labels.map(cat => expenseStats[cat].amount);
        const colors = labels.map(cat => getCategoryColor(cat));

        const chartCanvas = document.getElementById('categoryChart');
        const ctx = chartCanvas.getContext('2d');
        if (categoryChart) categoryChart.destroy();

        if (labels.length === 0) {
            ctx.clearRect(0, 0, chartCanvas.width, chartCanvas.height);
            ctx.font = '14px Arial'; ctx.fillStyle = '#999'; ctx.textAlign = 'center';
            ctx.fillText('‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ‡¶®‡ßá‡¶á', chartCanvas.width/2, chartCanvas.height/2);
            document.getElementById('categoryList').innerHTML = '<p style="text-align:center;color:#999;padding:20px;">‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ‡¶®‡ßá‡¶á</p>';
            return;
        }

        categoryChart = new Chart(ctx, {
            type: 'doughnut',
            data: { labels, datasets: [{ data: chartData, backgroundColor: colors, borderWidth: 3, borderColor: 'white' }] },
            options: {
                responsive: true, maintainAspectRatio: false, cutout: '65%',
                plugins: {
                    legend: { display: false },
                    tooltip: { callbacks: { label: function(context) {
                        const cat = context.label;
                        const amount = expenseStats[cat].amount;
                        const pct = totalExpense > 0 ? ((amount/totalExpense)*100).toFixed(1) : 0;
                        return [`${cat}: ‡ß≥${amount.toLocaleString('bn-BD')}`, `‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º‡ßá‡¶∞ ${pct}%`];
                    }}}
                }
            }
        });

        const categoryList = document.getElementById('categoryList');
        categoryList.innerHTML = '';
        labels.sort((a,b) => expenseStats[b].amount - expenseStats[a].amount).forEach(cat => {
            const amount = expenseStats[cat].amount;
            const color = getCategoryColor(cat);
            const pct = totalExpense > 0 ? ((amount/totalExpense)*100).toFixed(1) : 0;
            const div = document.createElement('div');
            div.className = 'category-item';
            div.innerHTML = `<div class="category-name"><span class="color-dot" style="background-color:${color};"></span><span>${escapeHtml(cat)}</span></div>
                <div style="display:flex;align-items:center;gap:6px;">
                    <span style="font-size:11px;font-weight:700;color:#fff;background:${color};padding:2px 7px;border-radius:10px;min-width:38px;text-align:center;">${pct}%</span>
                    <span class="category-amount">‡ß≥${amount.toLocaleString('bn-BD')}</span>
                </div>`;
            categoryList.appendChild(div);
        });
    }

    // ‚îÄ‚îÄ Edit & Delete ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let editingId = null;

    function toggleDropdown(e, id) {
        e.stopPropagation();
        closeAllDropdowns();
        const dd = document.getElementById('dd-' + id);
        if (dd) dd.classList.toggle('open');
    }
    function closeAllDropdowns() {
        document.querySelectorAll('.dropdown-menu.open').forEach(d => d.classList.remove('open'));
    }
    document.addEventListener('click', closeAllDropdowns);

    function openEditModal(id) {
        const item = transactions.find(i => i.id === id);
        if (!item) return;
        editingId = id;
        document.getElementById('edit-type').value = item.type;
        populateEditCategorySelect(item.type, item.category);
        document.getElementById('edit-amount').value = item.amount;
        document.getElementById('edit-title').value = item.title;
        document.getElementById('edit-date').value = item.date;
        document.getElementById('edit-note').value = item.note || '';
        document.getElementById('edit-type').onchange = function() { populateEditCategorySelect(this.value, ''); };
        document.getElementById('editModal').classList.add('active');
    }
    function populateEditCategorySelect(type, selectedCat) {
        const sel = document.getElementById('edit-category');
        sel.innerHTML = '<option value="">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
        categories[type].forEach(cat => {
            const opt = document.createElement('option');
            opt.value = cat.name; opt.textContent = cat.name;
            if (cat.name === selectedCat) opt.selected = true;
            sel.appendChild(opt);
        });
    }
    function closeEditModal() {
        document.getElementById('editModal').classList.remove('active');
        editingId = null;
    }

    async function saveEdit() {
        const amount = parseFloat(document.getElementById('edit-amount').value);
        const title = document.getElementById('edit-title').value.trim();
        const category = document.getElementById('edit-category').value;
        const dateStr = document.getElementById('edit-date').value;
        const type = document.getElementById('edit-type').value;
        const note = document.getElementById('edit-note').value.trim();

        if (!amount || amount <= 0) { alert('‡¶∏‡¶†‡¶ø‡¶ï ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶¶‡¶ø‡¶®'); return; }
        if (!title) { alert('‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶¶‡¶ø‡¶®'); return; }
        if (!category) { alert('‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®'); return; }
        if (!dateStr) { alert('‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®'); return; }

        showLoading('‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');
        const { error } = await sb.from('transactions').update({ type, amount, title, category, date: dateStr, note }).eq('id', editingId);
        hideLoading();
        if (error) { alert('‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá'); return; }

        const idx = transactions.findIndex(i => i.id === editingId);
        if (idx !== -1) transactions[idx] = { ...transactions[idx], type, amount, title, category, date: dateStr, note };
        render();
        closeEditModal();
        alert('‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
    }

    async function deleteWithPin(id) {
        const enteredPin = prompt('‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá PIN ‡¶¶‡¶ø‡¶®:');
        if (enteredPin === null) return;
        if (enteredPin !== userPin) { alert('‡¶≠‡ßÅ‡¶≤ PIN!'); return; }
        if (!confirm('‡¶è‡¶á ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®?')) return;
        showLoading('‡¶Æ‡ßÅ‡¶õ‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');
        const { error } = await sb.from('transactions').delete().eq('id', id);
        hideLoading();
        if (error) { alert('‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá'); return; }
        transactions = transactions.filter(i => i.id !== id);
        render();
        if (currentTab === 'history') renderHistory();
        alert('‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
    }

    // ‚îÄ‚îÄ Side Menu ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function toggleMenu() {
        document.getElementById('sideMenu').classList.toggle('active');
        document.getElementById('overlay').classList.toggle('active');
    }
    function clearSearch() {
        document.getElementById('search-input').value = '';
        document.getElementById('search-clear').style.display = 'none';
        render();
    }

    // ‚îÄ‚îÄ PIN Change ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function setNewPin() {
        const oldPin = prompt('‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® PIN:');
        if (oldPin === null) return;
        if (oldPin !== userPin) { alert('‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® PIN ‡¶≠‡ßÅ‡¶≤!'); return; }
        const newPin = prompt('‡¶®‡¶§‡ßÅ‡¶® ‡ß™ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ PIN ‡¶¶‡¶ø‡¶®:');
        if (newPin === null) return;
        if (!newPin || newPin.length !== 4 || !/^\d+$/.test(newPin)) { alert('PIN ‡¶†‡¶ø‡¶ï ‡ß™‡¶ü‡¶ø ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá!'); return; }
        showLoading('‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');
        await sb.from('users').update({ pin: newPin }).eq('username', currentUser.username);
        hideLoading();
        userPin = newPin;
        alert('PIN ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
    }

    // ‚îÄ‚îÄ History Tab ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function setHistView(event, view) {
        histView = view;
        document.querySelectorAll('#page-history .view-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        document.getElementById('hist-monthly-filter').style.display = view === 'monthly' ? 'flex' : 'none';
        document.getElementById('hist-yearly-filter').style.display = view === 'yearly' ? 'flex' : 'none';
        document.getElementById('hist-custom-filter').style.display = view === 'custom' ? 'block' : 'none';
        renderHistory();
    }

    function renderHistory() {
        const q = (document.getElementById('history-search')?.value || '').trim().toLowerCase();
        const container = document.getElementById('history-list');
        if (!container) return;

        const now = new Date();
        const selM = parseInt(document.getElementById('filter-month')?.value ?? now.getMonth());
        const selY = parseInt(document.getElementById('filter-year')?.value ?? now.getFullYear());
        const selYOnly = parseInt(document.getElementById('filter-year-only')?.value ?? now.getFullYear());
        const startDate = document.getElementById('filter-start-date')?.value || '';
        const endDate = document.getElementById('filter-end-date')?.value || '';

        let data = [...transactions].sort((a,b) => b.date.localeCompare(a.date));

        if (histView === 'monthly') {
            data = data.filter(t => {
                const d = new Date(t.date + 'T00:00:00');
                return d.getMonth() === selM && d.getFullYear() === selY;
            });
        } else if (histView === 'yearly') {
            data = data.filter(t => new Date(t.date + 'T00:00:00').getFullYear() === selYOnly);
        } else if (histView === 'custom' && startDate && endDate) {
            data = data.filter(t => t.date >= startDate && t.date <= endDate);
        } else if (histView === 'custom') {
            data = [];
        }

        const hIncome = data.filter(i=>i.type==='income').reduce((s,i)=>s+i.amount,0);
        const hExpense = data.filter(i=>i.type==='expense').reduce((s,i)=>s+i.amount,0);
        const labels = { monthly:'‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï', yearly:'‡¶¨‡¶æ‡¶∞‡ßç‡¶∑‡¶ø‡¶ï', custom:'‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§' };
        const lbl = labels[histView] || '';
        const hii = document.getElementById('hist-total-income');
        const hei = document.getElementById('hist-total-expense');
        const hbi = document.getElementById('hist-balance');
        const hit = document.getElementById('hist-income-title');
        const het = document.getElementById('hist-expense-title');
        if (hii) hii.textContent = '‡ß≥' + hIncome.toLocaleString('bn-BD');
        if (hei) hei.textContent = '‡ß≥' + hExpense.toLocaleString('bn-BD');
        if (hbi) hbi.textContent = '‡ß≥' + (hIncome - hExpense).toLocaleString('bn-BD');
        if (hit) hit.textContent = lbl + ' ‡¶Ü‡¶Ø‡¶º';
        if (het) het.textContent = lbl + ' ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º';

        if (q) data = data.filter(t =>
            t.title.toLowerCase().includes(q) ||
            (t.category||'').toLowerCase().includes(q) ||
            (t.note||'').toLowerCase().includes(q)
        );

        if (data.length === 0) { container.innerHTML = '<p class="empty-state">‡¶ï‡ßã‡¶®‡ßã ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶®‡ßá‡¶á</p>'; return; }

        container.innerHTML = '';
        data.forEach(item => {
            const typeText = item.type === 'income' ? '‡¶Ü‡¶Ø‡¶º' : '‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º';
            const color = item.type === 'income' ? 'var(--income-green)' : 'var(--expense-red)';
            container.innerHTML += `<div class="item" style="border-left-color:${color}">
                <div style="flex:1;">
                    <b>${escapeHtml(item.title)}</b><span class="cat-badge">${escapeHtml(item.category||'‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£')}</span>
                    <br><small style="color:#888">${formatDate(item.date)}</small>
                    ${item.note ? `<div class="item-note">üìù ${escapeHtml(item.note)}</div>` : ''}
                </div>
                <div style="text-align:right;white-space:nowrap;display:flex;align-items:center;gap:2px;">
                    <div style="color:${color};font-weight:bold">${typeText} ‡ß≥${item.amount.toLocaleString('bn-BD')}</div>
                    <div class="item-actions">
                        <button class="three-dot-btn" onclick="toggleDropdown(event,'${item.id}')">‚ãÆ</button>
                        <div class="dropdown-menu" id="dd-${item.id}">
                            <button class="dropdown-item edit" onclick="openEditModal('${item.id}');closeAllDropdowns()">‚úèÔ∏è ‡¶è‡¶°‡¶ø‡¶ü</button>
                            <div class="dropdown-divider"></div>
                            <button class="dropdown-item delete" onclick="deleteWithPin('${item.id}');closeAllDropdowns()">üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                        </div>
                    </div>
                </div>
            </div>`;
        });
    }

    // ‚îÄ‚îÄ Tab Navigation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function switchTab(tab) {
        currentTab = tab;
        const pc = document.getElementById('pageContent');
        if (pc) pc.scrollTop = 0;
        ['list','page-history','page-analytics','page-settings'].forEach(id => {
            const el = document.getElementById(id);
            if (el) { el.style.display = 'none'; el.style.flexDirection = ''; }
        });
        const fixedTop = document.querySelector('.fixed-top-section');
        const budgetSec = document.getElementById('budgetSection');
        if (tab === 'home') {
            if (fixedTop) fixedTop.style.display = '';
            if (budgetSec) budgetSec.style.display = '';
            document.getElementById('list').style.display = '';
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            document.getElementById('nav-home').classList.add('active');
        } else if (tab === 'history') {
            if (fixedTop) fixedTop.style.display = 'none';
            if (budgetSec) budgetSec.style.display = 'none';
            const histPage = document.getElementById('page-history');
            histPage.style.display = 'flex';
            histPage.style.flexDirection = 'column';
            histPage.style.height = '100%';
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            document.getElementById('nav-history').classList.add('active');
            populateFilters();
            renderHistory();
        } else if (tab === 'analytics') {
            if (fixedTop) fixedTop.style.display = 'none';
            if (budgetSec) budgetSec.style.display = 'none';
            document.getElementById('page-analytics').style.display = 'block';
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            document.getElementById('nav-analytics').classList.add('active');
            setTimeout(() => { updateChartAndList(transactions); renderBarChartInline(); }, 50);
        } else if (tab === 'settings') {
            if (fixedTop) fixedTop.style.display = 'none';
            if (budgetSec) budgetSec.style.display = 'none';
            document.getElementById('page-settings').style.display = 'block';
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            document.getElementById('nav-settings').classList.add('active');
        }
    }

    // ‚îÄ‚îÄ Analytics ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderBarChartInline() {
        const months = ['‡¶ú‡¶æ‡¶®‡ßÅ','‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ','‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö','‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤','‡¶Æ‡ßá','‡¶ú‡ßÅ‡¶®','‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á','‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü','‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá','‡¶Ö‡¶ï‡ßç‡¶ü‡ßã','‡¶®‡¶≠‡ßá','‡¶°‡¶ø‡¶∏‡ßá'];
        const now = new Date();
        const labels = [], incomeData = [], expenseData = [];
        for (let i = 5; i >= 0; i--) {
            const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
            const m = d.getMonth(), y = d.getFullYear();
            labels.push(months[m]);
            const mTx = transactions.filter(t => {
                const td = new Date(t.date + 'T00:00:00');
                return td.getMonth() === m && td.getFullYear() === y;
            });
            incomeData.push(mTx.filter(t=>t.type==='income').reduce((s,t)=>s+t.amount,0));
            expenseData.push(mTx.filter(t=>t.type==='expense').reduce((s,t)=>s+t.amount,0));
        }
        if (barChartInlineInstance) barChartInlineInstance.destroy();
        const canvas = document.getElementById('barChartInline');
        if (!canvas) return;
        barChartInlineInstance = new Chart(canvas.getContext('2d'), {
            type: 'bar',
            data: { labels, datasets: [
                { label: '‡¶Ü‡¶Ø‡¶º', data: incomeData, backgroundColor: '#4CAF50', borderRadius: 4 },
                { label: '‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º', data: expenseData, backgroundColor: '#e91e63', borderRadius: 4 }
            ]},
            options: { responsive: true, plugins: { legend: { position: 'top' } }, scales: { y: { beginAtZero: true } } }
        });
    }

    // ‚îÄ‚îÄ Bar Chart Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function openBarChartModal() {
        document.getElementById('barChartModal').classList.add('active');
        renderBarChart();
    }
    function closeBarChartModal() {
        document.getElementById('barChartModal').classList.remove('active');
    }
    function renderBarChart() {
        const months = ['‡¶ú‡¶æ‡¶®‡ßÅ','‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ','‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö','‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤','‡¶Æ‡ßá','‡¶ú‡ßÅ‡¶®','‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á','‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü','‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá','‡¶Ö‡¶ï‡ßç‡¶ü‡ßã','‡¶®‡¶≠‡ßá','‡¶°‡¶ø‡¶∏‡ßá'];
        const now = new Date();
        const labels = [], incomeData = [], expenseData = [];
        for (let i = 5; i >= 0; i--) {
            const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
            const m = d.getMonth(), y = d.getFullYear();
            labels.push(months[m] + ' \'' + String(y).slice(2));
            const mTx = transactions.filter(t => { const td = new Date(t.date+'T00:00:00'); return td.getMonth()===m && td.getFullYear()===y; });
            incomeData.push(mTx.filter(t=>t.type==='income').reduce((s,t)=>s+t.amount,0));
            expenseData.push(mTx.filter(t=>t.type==='expense').reduce((s,t)=>s+t.amount,0));
        }
        if (barChartInstance) barChartInstance.destroy();
        barChartInstance = new Chart(document.getElementById('barChart').getContext('2d'), {
            type: 'bar',
            data: { labels, datasets: [
                { label: '‡¶Ü‡¶Ø‡¶º', data: incomeData, backgroundColor: '#4CAF50', borderRadius: 4 },
                { label: '‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º', data: expenseData, backgroundColor: '#e91e63', borderRadius: 4 }
            ]},
            options: { responsive: true, plugins: { legend: { position: 'top' } }, scales: { y: { beginAtZero: true } } }
        });
    }

    // ‚îÄ‚îÄ Budget ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function openBudgetModal() {
        const modal = document.getElementById('budgetModal');
        const container = document.getElementById('budgetInputs');
        container.innerHTML = '';
        categories.expense.forEach(cat => {
            const val = budgets[cat.name] || '';
            container.innerHTML += `<div class="form-group">
                <label style="display:flex;align-items:center;gap:6px;">
                    <span style="width:12px;height:12px;border-radius:50%;background:${cat.color};display:inline-block;"></span>
                    ${escapeHtml(cat.name)}
                </label>
                <input type="number" id="budget-${escapeHtml(cat.name)}" placeholder="‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∏‡ßÄ‡¶Æ‡¶æ (‡ß≥)" value="${val}" style="border:2px solid #ddd;border-radius:8px;padding:10px;width:100%;font-size:14px;">
            </div>`;
        });
        modal.classList.add('active');
    }
    function closeBudgetModal() {
        document.getElementById('budgetModal').classList.remove('active');
    }
    async function saveBudgets() {
        showLoading('‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');
        for (const cat of categories.expense) {
            const el = document.getElementById('budget-' + cat.name);
            if (el && el.value) {
                const amount = parseFloat(el.value);
                await sb.from('budgets').upsert({ username: currentUser.username, category: cat.name, amount }, { onConflict: 'username,category' });
                budgets[cat.name] = amount;
            } else {
                await sb.from('budgets').delete().eq('username', currentUser.username).eq('category', cat.name);
                delete budgets[cat.name];
            }
        }
        hideLoading();
        closeBudgetModal();
        renderBudgetSection();
        showToast('‚úÖ ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
    }
    function renderBudgetSection() {
        const section = document.getElementById('budgetSection');
        const bars = document.getElementById('budgetBars');
        if (!section || !bars) return;
        const hasBudget = Object.keys(budgets).length > 0;
        section.classList.toggle('visible', hasBudget);
        if (!hasBudget) return;
        const now = new Date();
        const selM = now.getMonth(), selY = now.getFullYear();
        const monthExp = transactions.filter(i => {
            if (i.type !== 'expense') return false;
            const d = new Date(i.date + 'T00:00:00');
            return d.getMonth() === selM && d.getFullYear() === selY;
        });
        const catExp = {};
        monthExp.forEach(i => { catExp[i.category||'‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£'] = (catExp[i.category||'‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£']||0) + i.amount; });
        bars.innerHTML = '';
        Object.entries(budgets).forEach(([cat, limit]) => {
            const spent = catExp[cat] || 0;
            const pct = Math.min((spent/limit)*100, 100).toFixed(0);
            const over = spent > limit;
            const color = over ? '#f44336' : spent/limit > 0.8 ? '#ff9800' : '#4caf50';
            bars.innerHTML += `<div class="budget-item">
                <div class="budget-label">
                    <span ${over?'class="budget-warn"':''}>${escapeHtml(cat)}</span>
                    <span ${over?'class="budget-warn"':''}>‡ß≥${spent.toLocaleString('bn-BD')} / ‡ß≥${limit.toLocaleString('bn-BD')} (${pct}%)</span>
                </div>
                <div class="budget-bar-bg"><div class="budget-bar-fill" style="width:${pct}%;background:${color};"></div></div>
            </div>`;
        });
    }

    // ‚îÄ‚îÄ Export / Share ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function createBackup() {
        if (transactions.length === 0) { alert('‡¶ï‡ßã‡¶®‡ßã ‡¶°‡ßá‡¶ü‡¶æ ‡¶®‡ßá‡¶á'); return; }
        const dataStr = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify({ transactions, categories }, null, 2));
        const dl = document.createElement('a');
        dl.setAttribute('href', dataStr);
        dl.setAttribute('download', 'smart_hisab_' + currentUser.displayName + '_backup_' + new Date().toISOString().split('T')[0] + '.json');
        dl.click();
    }

    async function restoreBackup(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = async (e) => {
            try {
                const data = JSON.parse(e.target.result);
                const txList = Array.isArray(data) ? data : (data.transactions || []);
                showLoading('‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');
                await sb.from('transactions').delete().eq('username', currentUser.username);
                const rows = txList.map(t => ({ ...t, id: t.id || Date.now().toString(), username: currentUser.username }));
                if (rows.length > 0) await sb.from('transactions').insert(rows);
                transactions = rows;
                render();
                hideLoading();
                alert('‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶∏‡¶´‡¶≤ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            } catch(err) {
                hideLoading();
                alert('‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ' + err.message);
            }
        };
        reader.readAsText(file);
    }

    function exportToExcel() {
        if (transactions.length === 0) { alert('‡¶ï‡ßã‡¶®‡ßã ‡¶°‡ßá‡¶ü‡¶æ ‡¶®‡ßá‡¶á'); return; }
        const exportData = transactions.map(item => ({
            '‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ': item.date, '‡¶¨‡¶ø‡¶¨‡¶∞‡¶£': item.title, '‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø': item.category||'‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£',
            '‡¶Ü‡¶Ø‡¶º': item.type==='income'?item.amount:'', '‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º': item.type==='expense'?item.amount:'', '‡¶®‡ßã‡¶ü': item.note||''
        }));
        const ws = XLSX.utils.json_to_sheet(exportData);
        ws['!cols'] = [{ wch:12 },{ wch:20 },{ wch:15 },{ wch:12 },{ wch:12 },{ wch:25 }];
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, '‡¶Ü‡¶Ø‡¶º ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º');
        XLSX.writeFile(wb, 'smart_hisab_' + currentUser.displayName + '_' + new Date().toISOString().split('T')[0] + '.xlsx');
    }

    function exportPDF() {
        const selM = parseInt(document.getElementById('filter-month').value);
        const selY = parseInt(document.getElementById('filter-year').value);
        const months = ['‡¶ú‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø','‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø','‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö','‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤','‡¶Æ‡ßá','‡¶ú‡ßÅ‡¶®','‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á','‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü','‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞','‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞','‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞','‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞'];
        const mTx = transactions.filter(t => {
            const d = new Date(t.date+'T00:00:00');
            return d.getMonth()===selM && d.getFullYear()===selY;
        });
        const totalIncome = mTx.filter(i=>i.type==='income').reduce((s,i)=>s+i.amount,0);
        const totalExpense = mTx.filter(i=>i.type==='expense').reduce((s,i)=>s+i.amount,0);
        const rows = [...mTx].sort((a,b)=>a.date.localeCompare(b.date)).map(t =>
            `<tr><td>${t.date}</td><td>${t.title}</td><td>${t.category||'‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£'}</td>
             <td style="color:green">${t.type==='income'?'‡ß≥'+t.amount:''}</td>
             <td style="color:red">${t.type==='expense'?'‡ß≥'+t.amount:''}</td>
             <td style="font-size:11px;color:#888">${t.note||''}</td></tr>`
        ).join('');
        const html = `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</title>
        <style>body{font-family:Arial,sans-serif;padding:20px}table{width:100%;border-collapse:collapse;margin-top:16px}th,td{border:1px solid #ddd;padding:8px;font-size:13px}th{background:#008080;color:white}.summary{display:flex;gap:16px;margin:16px 0}.scard{padding:12px 20px;border-radius:10px;color:white;text-align:center}.scard h3{margin:0;font-size:20px}</style>
        </head><body>
        <h1>üìä ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‚Äî ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h1>
        <p>‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ: <b>${currentUser.displayName}</b> | ‡¶Æ‡¶æ‡¶∏: <b>${months[selM]} ${selY}</b></p>
        <div class="summary">
            <div class="scard" style="background:#0e8a16"><h3>‡ß≥${totalIncome.toLocaleString()}</h3><p>‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º</p></div>
            <div class="scard" style="background:#c90a4d"><h3>‡ß≥${totalExpense.toLocaleString()}</h3><p>‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º</p></div>
            <div class="scard" style="background:#008080"><h3>‡ß≥${(totalIncome-totalExpense).toLocaleString()}</h3><p>‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p></div>
        </div>
        <table><thead><tr><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th><th>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</th><th>‡¶Ü‡¶Ø‡¶º</th><th>‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º</th><th>‡¶®‡ßã‡¶ü</th></tr></thead>
        <tbody>${rows}</tbody></table>
        <p style="margin-top:20px;font-size:11px;color:#aaa">‡¶§‡ßà‡¶∞‡¶ø: ${new Date().toLocaleString()}</p>
        <\/body><\/html>`;
        const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `‡¶π‡¶ø‡¶∏‡¶æ‡¶¨_${currentUser.displayName}_${months[selM]}_${selY}.html`;
        a.click();
        showToast('üìÑ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');
    }

    function shareSummary() {
        const now = new Date();
        const todayStr = now.toISOString().split('T')[0];
        const mTx = transactions.filter(t => t.date === todayStr);
        const totalIncome = mTx.filter(i=>i.type==='income').reduce((s,i)=>s+i.amount,0);
        const totalExpense = mTx.filter(i=>i.type==='expense').reduce((s,i)=>s+i.amount,0);
        const text = `üìä ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‚Äî ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüíö ‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º:   ‡ß≥${totalIncome.toLocaleString('bn-BD')}\n‚ù§Ô∏è ‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º: ‡ß≥${totalExpense.toLocaleString('bn-BD')}\nüí∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥${(totalIncome-totalExpense).toLocaleString('bn-BD')}\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüìå ‡¶Æ‡ßã‡¶ü ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø: ${mTx.length}‡¶ü‡¶ø`;
        if (navigator.share) { navigator.share({ title: '‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨', text }); }
        else if (navigator.clipboard) { navigator.clipboard.writeText(text); showToast('üìã ‡¶ï‡ßç‡¶≤‡¶ø‡¶™‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!'); }
        else { showToast('‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶®‡ßá‡¶á'); }
    }

    // ‚îÄ‚îÄ Dark Mode ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function toggleDarkMode() {
        darkMode = !darkMode;
        document.body.classList.toggle('dark', darkMode);
        const lbl = document.getElementById('darkModeLabel');
        if (lbl) lbl.textContent = darkMode ? '‚òÄÔ∏è ‡¶≤‡¶æ‡¶á‡¶ü ‡¶Æ‡ßã‡¶°' : 'üåô ‡¶°‡¶æ‡¶∞‡ßç‡¶ï ‡¶Æ‡ßã‡¶°';
    }

    // ‚îÄ‚îÄ Toast ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function showToast(msg) {
        const t = document.getElementById('shareToast');
        if (!t) return;
        t.textContent = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 2500);
    }

</script>
<!-- Bar Chart Modal -->
<div class="chart-modal" id="barChartModal">
    <div class="chart-modal-content">
        <span class="close-panel" onclick="closeBarChartModal()">√ó</span>
        <div class="chart-modal-title">üìà ‡¶Æ‡¶æ‡¶∏‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶Ü‡¶Ø‡¶º ‡¶ì ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º</div>
        <canvas id="barChart" style="max-height:300px;"></canvas>
    </div>
</div>

<!-- Budget Modal -->
<div class="budget-modal" id="budgetModal">
    <div class="budget-modal-content">
        <span class="close-panel" onclick="closeBudgetModal()">√ó</span>
        <div style="text-align:center; font-size:17px; font-weight:bold; margin-bottom:16px;">üìä ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶£</div>
        <p style="font-size:12px; color:#888; text-align:center; margin-bottom:14px;">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∏‡ßÄ‡¶Æ‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
        <div id="budgetInputs"></div>
        <button class="submit-btn" onclick="saveBudgets()">‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
</div>

<!-- Toast -->
<div class="share-toast" id="shareToast"></div>

</body>
</html>